---
import { certifications } from '../../data/certifications';
import { Image } from 'astro:assets';
import { Icon } from 'astro-icon/components';
---

<section id="certifications" class="section">
  <div class="cert-group">
    {
      certifications.map((cert) => {
        const isLink = cert.url && cert.url !== '#';
        const attachmentLink = cert.attachment || cert.url;
        
        return (
          <div class="cert-card group">
            <div class="grid-layout">
              <div class="image-container">
                 {attachmentLink ? (
                    <a href={attachmentLink} target="_blank" rel="noreferrer" class="image-link cert-image-wrapper">
                      {cert.image ? (
                        <Image 
                          src={cert.image} 
                          alt={`Preview of ${cert.title}`} 
                          class="cert-preview-image" 
                          width={200}
                        />
                      ) : (
                        <div class="cert-placeholder">
                          <Icon name="heroicons:document-text" class="cert-icon" />
                          <span class="cert-ext">PDF</span>
                        </div>
                      )}
                    </a>
                 ) : (
                    <div class="cert-image-wrapper locked-wrapper">
                         <div class="cert-placeholder">
                            <span class="cert-ext">CERT</span>
                         </div>
                    </div>
                 )}
              </div>

              <div class="content-col">
                <h3 class="cert-header">
                  {isLink ? (
                    <a href={cert.url} target="_blank" rel="noreferrer" class="cert-link">
                      <span class="title">
                        {cert.title}
                        <Icon name="heroicons:arrow-up-right-20-solid" class="link-icon" />
                      </span>
                    </a>
                  ) : (
                    <span class="title">{cert.title}</span>
                  )}
                </h3>
                
                <div class="cert-meta">
                  <span class="issuer">{cert.issuer}</span>
                  <span class="separator">â€¢</span>
                  <span class="date">{cert.date}</span>
                </div>

                {cert.id && <p class="cert-id">{cert.id}</p>}
              </div>
            </div>
          </div>
        );
      })
    }
  </div>
</section>

<style>
  .cert-group {
    display: flex;
    flex-direction: column;
    gap: 1rem; /* Matched projects gap */
  }

  .cert-card {
    position: relative;
    display: block;
    text-decoration: none;
    color: inherit;
    padding: 1.5rem; /* Matched projects padding */
    border-radius: 0.5rem;
    transition: all 0.3s ease;
    overflow: hidden;
    background: transparent;
    border: 1px solid transparent;
  }

  .cert-card:hover {
    background-color: rgba(255, 255, 255, 0.03);
    box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.3);
    border-color: rgba(255, 255, 255, 0.05);
  }

  /* Layout */
  .grid-layout {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: 100px 1fr; /* Fixed small width for the image column */
    gap: 1rem;
    align-items: start;
  }

  @media (min-width: 640px) {
    .grid-layout {
      grid-template-columns: 150px 1fr; /* Match Projects.astro/Experience.astro width */
      gap: 1.5rem;
    }
  }

  /* Image Column */
  .image-container {
    display: flex;
    justify-content: flex-start;
    align-items: flex-start;
    padding-top: 0.25rem;
  }

  .cert-image-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    max-width: 120px; /* Prevent it from being too large */
    aspect-ratio: 16 / 9;
    border-radius: 4px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background-color: rgba(255, 255, 255, 0.05); /* Slightly lighter than projects for placeholder */
    overflow: hidden;
    transition: border-color 0.2s, background-color 0.2s;
  }
  
  .cert-card:hover .cert-image-wrapper {
    border-color: rgba(255, 255, 255, 0.3);
    background-color: rgba(255, 255, 255, 0.08);
  }

  .cert-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.2rem;
    color: var(--slate);
  }

  .cert-icon {
    width: 1.5rem;
    height: 1.5rem;
    opacity: 0.7;
  }

  .cert-ext {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    font-weight: 600;
    opacity: 0.7;
  }

  .cert-link .issuer {
     /* overridden below */
  }

  /* Content Column */
  .cert-header {
    margin: 0;
    padding: 0;
    font-size: 1.1rem;
    font-weight: 600;
    line-height: 1.2;
    color: var(--lightest-slate);
    margin-bottom: 0.25rem;
  }

  .cert-header .title {
    color: var(--lightest-slate);
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .cert-link {
    display: inline-block;
  }

  .link-icon {
    width: 1.25rem;
    height: 1.25rem;
    transition: all 0.2s ease;
    color: var(--slate);
  }

  .cert-link:hover .link-icon {
    color: var(--green);
    transform: translate(2px, -2px);
  }

  .cert-meta {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }

  .issuer {
    color: var(--green);
  }

  .separator {
    color: var(--slate);
    font-size: 0.8rem;
  }

  .date {
    font-family: var(--font-mono);
    font-size: 0.8rem;
    color: var(--slate);
  }

  .cert-id {
    font-family: var(--font-mono);
    font-size: 0.85rem;
    color: var(--slate);
    margin: 0;
    transition: color 0.2s;
  }

  .cert-card:hover .cert-id {
    color: var(--light-slate);
  }

  .cert-preview-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* Stretched link to make the whole card clickable - targeting the main link */
  .cert-link::after {
    content: '';
    position: absolute;
    inset: 0;
    z-index: 0;
  }
</style>